<!DOCTYPE html>
<html>
	<head>
		<meta charset='utf-8'>
		<title>Home</title>
		<style>
			@import url("https://fonts.googleapis.com/css2?family=Epilogue:wght@300&family=Roboto");
		</style>
		<link rel='stylesheet' href="/assets/css/styles.css">
		<script type='text/javascript' src="/assets/js/lib/jquery.min.js"></script>

<script type='text/javascript' src="/assets/js/lib/math.min.js"></script>

<script type='text/javascript' src="/assets/js/lib/js.cookie-2.2.1.min.js"></script>

<script src="/assets/js/node_modules/spacetime/builds/spacetime.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.1.0/MarkerCluster.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.1.0/MarkerCluster.Default.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css"/>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"/>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>

<script>
	baseURL = "http://0.0.0.0:5001"
	console.log("Base API URL: " + baseURL)
</script>

<script>
	String.prototype.hashCode = function(){
		var hash = 0;
		for (var i = 0; i < this.length; i++) {
			var character = this.charCodeAt(i);
			hash = ((hash<<5)-hash)+character;
			hash = hash & hash; // Convert to 32bit integer
		}
		return hash;
	}
	function makehash(object){
		return JSON.stringify(object).hashCode();
	}
</script>

<script>
	function updateCollapseables(){
		var collapseables = document.getElementsByClassName("collapsebutton");
		var i;
		for (i = 0; i < collapseables.length; i++) {
			collapseables[i].addEventListener("click", function() {
				this.classList.toggle("active");
				var content = this.nextElementSibling;
				if(content.style.display === "block") content.style.display = "none";
				else content.style.display = "block";
			});
		}
	}
</script>
	</head>
	<body>
		<style>
			#overlayeffect{
				pointer-events: none;
				opacity: .09;
				position: fixed;
				top: 0;
				width: 100%;
				height: 100%;
				z-index: 10000;
				background-image: url("https://thumbs.gfycat.com/AgileRichEwe-size_restricted.gif");
				
				/*
				"https://thumbs.gfycat.com/AbandonedSoupyKagu-max-1mb.gif"
				"
				http://i.imgur.com/urpyX45.gif
				https://art.pixilart.com/0928a2aa14e88da.gif
				https://i.gifer.com/R7cD.gif
				https://thumbs.gfycat.com/LikableCleverBaboon-max-1mb.gif
				background-size: contain;
				
				
				*/
			}
		</style>
		<div id='overlayeffect'></div>
		<!--div id='content'-->
			<style>html, body {width: 100%;height: 100%;margin: 0;padding: 0;}</style>
<style>#map {position:absolute;top:0;bottom:0;right:0;left:0;}</style>
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css"/>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"/>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css"/>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
<meta name="viewport" content="width=device-width,
initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<style>
#MAP {
	border-radius: 6px;
	border: 3px solid #0c0a0a;
	width: 100.0%;
	height: 100.0%;
	float: left;
}
</style>

<div class="folium-map" id="MAP" ></div>
<div>
<script>

	$.get(baseURL + "/incidents", {token: Cookies.get("auth"), count: 45, page: 0}, function(resp){
			inTable = `<tr> <td>
					<table cellspacing="0" cellpadding="1" width="100%">
						<tr>
							<th>Time</th><th>Type</th><th>Address</th>
						</tr>
					</table>
				</td></tr>
				<tr>
					<td>
						<div style='max-height: 400px; overflow:auto;'>
							<table cellspacing="0" cellpadding="1" width="100%">
				`;
			resp.forEach(element => {
				inTable += "<tr>" + 
					"<td>" + element.date + ", " + element.time  + "</td>" +
					"<td>" + element.type + "</td>" +
					"<td>" + element.address + "</td>" +
					"</tr>"
			});
			inTable += "</table></div></td></tr>"
			document.getElementById('incidents-log').innerHTML = inTable
			
		})

		$.get(baseURL + "/map.html", {token: Cookies.get("auth")}, function(resp){
			var s = document.createElement('script');
			s.innerText = resp
			document.head.appendChild(s);
		});
	</script>
		<!--/div-->
		<div style='min-height: 100px;'></div>
	</body>

	<script>
		document.body.onload = function() {
			auth = Cookies.get("auth") || "no"
			$.get("http://0.0.0.0:5001/checkauth", {token: auth}, function(resp){
			if(resp == "Unauthorized"){
				window.location = "/login";
			}
		});
		}
		
	</script>
</html>